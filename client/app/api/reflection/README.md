# Reflection API

This API handles creating and retrieving user reflections, which are enhanced with AI-powered feedback. All endpoints require user authentication.

---

## Endpoints

### `/api/reflection`

#### `POST`

Creates a new reflection, gets AI feedback on it, and saves it to the database.

**Authentication:** Required.

**Request Body:**

-   `message` (string, required): The user's reflection text.
-   `taskId` (string, optional): The ID of the task this reflection is associated with.

**Responses:**

-   `200 OK`: Reflection created successfully.
-   `400 Bad Request`: If the `message` is missing.
-   `401 Unauthorized`: If the user is not authenticated.
-   `500 Internal Server Error`: If there was a server-side error.

**Example Request:**
```json
{
  "message": "I finally finished the big project today. I feel a great sense of accomplishment, but I also think I could have managed my time better in the initial phases.",
  "taskId": "task-id-123"
}
```

**Example Response (200 OK):**
```json
{
  "success": true,
  "aiResponse": "That's a fantastic achievement! It's great that you're also thinking about how to improve your process for next time. What's one specific thing you could do differently at the start of your next project?",
  "reflectionId": "reflection-id-789"
}
```

---

#### `GET`

Retrieves a paginated history of the user's past reflections.

**Authentication:** Required.

**Query Parameters:**

-   `limit` (number, optional): The number of reflections to retrieve. Defaults to `10`.
-   `page` (number, optional): The page number for pagination. Defaults to `1`.

**Responses:**

-   `200 OK`: Successfully retrieved the reflection history.
-   `401 Unauthorized`: If the user is not authenticated.
-   `500 Internal Server Error`: If there was a server-side error.

**Example Response (200 OK):**
```json
{
  "reflections": [
    {
      "id": "reflection-id-789",
      "content": "I finally finished the big project today...",
      "aiFeedback": "That's a fantastic achievement!...",
      "createdAt": "2025-09-22T21:00:00.000Z",
      "task": {
        "id": "task-id-123",
        "title": "Finish the big project"
      }
    },
    {
      "id": "reflection-id-456",
      "content": "I struggled to stay focused today.",
      "aiFeedback": "It happens to everyone. What was the biggest distraction?",
      "createdAt": "2025-09-21T19:30:00.000Z",
      "task": null
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 25,
    "totalPages": 3
  }
}
```

**Note:** The AI response is currently generated by a placeholder function. In a production environment, this would be replaced with a call to a real AI service like the Gemini API.